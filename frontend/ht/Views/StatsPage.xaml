<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:ht.Views"
             x:Class="ht.Views.StatsPage"
             Title="Stats">
    <ContentPage.Resources>
        <ResourceDictionary>
            <local:ProgressionColorConverter x:Key="ProgressionColorConverter"/>
            <local:IsNotNullConverter x:Key="IsNotNullConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView Padding="10">
        <VerticalStackLayout Spacing="15">
            <Frame BackgroundColor="#6200EE" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Weight Tracking" FontSize="20" FontAttributes="Bold" TextColor="White"/>

                    <HorizontalStackLayout Spacing="10">
                        <Entry Placeholder="Current Weight (kg)"
                               Text="{Binding CurrentWeight}"
                               Keyboard="Numeric"
                               WidthRequest="150"/>
                        <Button Text="Update"
                                Command="{Binding UpdateWeightCommand}"
                                BackgroundColor="#03DAC6"
                                TextColor="Black"/>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Entry Placeholder="Goal Weight (kg)"
                               Text="{Binding GoalWeight}"
                               Keyboard="Numeric"
                               WidthRequest="150"/>
                        <Button Text="Set Goal"
                                Command="{Binding UpdateGoalCommand}"
                                BackgroundColor="#03DAC6"
                                TextColor="Black"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <Frame BackgroundColor="#F5F5F5" Padding="15" IsVisible="{Binding WeightStats, Converter={StaticResource IsNotNullConverter}}">
                <VerticalStackLayout Spacing="5">
                    <Label FontSize="16" FontAttributes="Bold">
                        <Label.Text>
                            <MultiBinding StringFormat="Weight to Lose: {0:F1} kg">
                                <Binding Path="WeightStats.weight_to_lose"/>
                            </MultiBinding>
                        </Label.Text>
                    </Label>
                    <Label FontSize="16">
                        <Label.Text>
                            <MultiBinding StringFormat="Avg. Weekly Loss: {0:F1} kg/week">
                                <Binding Path="WeightStats.average_weekly_loss"/>
                            </MultiBinding>
                        </Label.Text>
                    </Label>
                    <Label FontSize="16">
                        <Label.Text>
                            <MultiBinding StringFormat="Weeks to Goal: {0}">
                                <Binding Path="WeightStats.weeks_to_goal"/>
                            </MultiBinding>
                        </Label.Text>
                    </Label>
                    <Label FontSize="16">
                        <Label.Text>
                            <MultiBinding StringFormat="Est. Completion: {0}">
                                <Binding Path="WeightStats.estimated_completion_date"/>
                            </MultiBinding>
                        </Label.Text>
                    </Label>
                </VerticalStackLayout>
            </Frame>

            <Label Text="Exercise Progression" FontSize="20" FontAttributes="Bold"/>

            <Picker Title="Filter by Category"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCategory}"/>

            <CollectionView ItemsSource="{Binding FilteredExercises}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Margin="0,5" Padding="10" BackgroundColor="#F5F5F5">
                            <VerticalStackLayout>
                                <Label Text="{Binding exercise_name}"
                                       FontSize="16"
                                       FontAttributes="Bold"/>
                                <Label Text="{Binding category_name}"
                                       FontSize="12"
                                       TextColor="Gray"/>
                                <Label FontSize="14">
                                    <Label.Text>
                                        <MultiBinding StringFormat="Weekly Progression: {0:F1}%">
                                            <Binding Path="weekly_progression"/>
                                        </MultiBinding>
                                    </Label.Text>
                                    <Label.TextColor>
                                        <Binding Path="weekly_progression" Converter="{StaticResource ProgressionColorConverter}"/>
                                    </Label.TextColor>
                                </Label>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>